name: ðŸ” StealtHub AI - Pull Request Checks

on:
  pull_request:
    branches: [ main ]

env:
  PYTHON_VERSION: '3.9'

jobs:
  # ðŸ” Code Quality Checks
  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ðŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install flake8 black isort
        
    - name: ðŸ” Lint with flake8
      run: |
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
        
    - name: ðŸŽ¨ Check code formatting with Black
      run: |
        black --check --diff .
        
    - name: ðŸ“Š Check import sorting with isort
      run: |
        isort --check-only --diff .
        
  # ðŸ§ª Quick Tests
  quick-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ðŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ðŸ§ª Test AI Engine Import
      run: |
        python -c "from ai_engine.stealth_hub_ai_engine import StealthHubAI; print('AI Engine: OK')"
        
    - name: ðŸ§ª Test CLI Import
      run: |
        python -c "import stealth_hub_cli; print('CLI: OK')"
        
    - name: ðŸ§ª Test Main System Import
      run: |
        python -c "from main import FreeFireAIDevelopmentSystem; print('Main System: OK')"
        
    - name: ðŸ§ª Test Template System
      run: |
        python -c "from templates.game_templates import game_templates; print('Templates: OK')"
        
    - name: ðŸ§ª Test Offset Manager
      run: |
        python -c "from offset_manager.freefire_offset_manager import FreeFireOffsetManager; print('Offset Manager: OK')"
        
    - name: ðŸ§ª Test GUI Components
      run: |
        if [ -f "gui/control_panel.py" ]; then
          python -c "from gui.control_panel import FreeFireControlPanel; print('GUI Panel: OK')"
        else
          echo "GUI Panel: Not found, skipping"
        fi
        
  # ðŸ” Security Scan
  security-scan:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4
      
    - name: ðŸ Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: ðŸ” Install security tools
      run: |
        pip install bandit safety
        
    - name: ðŸ›¡ï¸ Run Bandit Security Scan
      run: |
        bandit -r . -f txt
      continue-on-error: true
      
    - name: ðŸ” Check dependencies for vulnerabilities
      run: |
        safety check
      continue-on-error: true
        
  # ðŸ“Š Generate Test Report
  test-report:
    runs-on: ubuntu-latest
    needs: [code-quality, quick-test, security-scan]
    
    steps:
    - name: ðŸ“Š PR Summary
      run: |
        echo "## ðŸ” Pull Request Analysis" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Completed Checks" >> $GITHUB_STEP_SUMMARY
        echo "- Code Quality: Passed" >> $GITHUB_STEP_SUMMARY
        echo "- Import Tests: Passed" >> $GITHUB_STEP_SUMMARY
        echo "- Security Scan: Completed" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“‹ Repository Structure" >> $GITHUB_STEP_SUMMARY
        echo "```" >> $GITHUB_STEP_SUMMARY
        find . -type f -name "*.py" | head -20 >> $GITHUB_STEP_SUMMARY
        echo "```" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Repository**: ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
        echo "**PR**: #${{ github.event.pull_request.number }}" >> $GITHUB_STEP_SUMMARY
        echo "**Author**: ${{ github.event.pull_request.user.login }}" >> $GITHUB_STEP_SUMMARY